{% extends 'base_menu.html' %}
{% block content %}
{% load static %}
<link href="{% static 'css/home-review.css' %}" rel="stylesheet">
<main class="main-content">
    <div class="critique-grid">
            <div class="critique-column">
                <div id="formContent">
                    <h2 class="active">Publier une critique</h2>
                    <form method="post" action="{% url 'create_ticket_review' %}" class="critique-form">
                        {% csrf_token %}
                        <input type="submit" class="fadeIn second" value="Publier une critique">
                    </form>
                </div>
            </div>    
            <div class="critique-column">
                <div id="formContent">
                    <h2 class="active">Demander une critique</h2>
                    <form method="post" action="{% url 'create_ticket' %}" class="critique-form">
                        {% csrf_token %}
                        <input type="submit" class="fadeIn second" value="Demander une critique">
                    </form>
                </div>
            </div>
            <div class="critique-column" style="grid-column: span 2;">
                <div id="formContent">
                    <h2 class="active">Tickets et Critiques des utilisateurs suivis</h2>
                    {% for ticket in following_tickets %}
                    {% if ticket.user != request.user %}
                    {% if not ticket.has_review %}
                    <div class="line ticket">
                        <h3 class="active"><strong>Ticket posté par : {{ ticket.user.username }}</strong></h3>
                        <ul>
                            <li><strong>Titre : </strong>{{ ticket.title }}</li>
                            <li><strong>Description : </strong>{{ ticket.description }}</li>
                            <li><strong>Date de création :</strong> {{ ticket.time_created }}</li>
                            {% if ticket.image %}
                                <li><img src="{{ ticket.image.url }}" alt="{{ ticket.title }}" class="image-posts"></li>
                            {% endif %}
                            
                        </ul>
                        <form method="post" action="{% url 'create_review' ticket.id %}">
                            {% csrf_token %}
                            <input type="hidden" name="ticket_id" value="{{ ticket.id }}">
                            <input type="submit" class="fadeIn second" value="Créer une critique">
                        </form>
                    </div>
                    {% endif %}
                    <ul class="ticket_reviews">
                        {% for review in following_reviews %}
                        {% if review.ticket == ticket %}
                        <li class="line review">
                            <h3 class="active"><strong> Critique écrite par {% if review.user == request.user %} Vous {% else %} {{ review.user.username }} {% endif %}</strong></h3>
                            <ul>
                                <li class="text-mini">En réponse au Ticket {{ review.ticket.title }} posté par <strong>{% if review.ticket.user == request.user %} Vous {% else %} {{ review.ticket.user.username }} {% endif %}</strong></li>
                                <li><strong>Titre : </strong>{{ review.ticket.title }}</li>
                                <li><strong>Description : </strong>{{ review.ticket.description }}</li>
                                <li><strong>Date de création : </strong>{{ review.ticket.time_created }}</li>
                                {% if review.ticket.image %}
                                    <li><img src="{{ review.ticket.image.url }}" alt="{{ review.ticket.title }}" class="image-posts"></li>
                                {% endif %}
                            </ul>
                            <ul>
                                <li><strong>Critique</strong></li>
                                <li><strong>Titre : </strong> {{ review.headline }}</li>
                                <li><strong>Note : </strong>
                                <div class="rating">
                                    {% for _ in review.get_rating_range %}
                                        <span class="star">&#9733;</span>
                                    {% endfor %}
                                    {% for _ in review.get_complement_range %}
                                        <span class="star">&#9734;</span>
                                    {% endfor %}
                                </div></li>
                                <li><strong>Description : </strong> {{ review.body }}</li>
                                <li><strong>Date de création : </strong> {{ review.time_created }}</li>
                            </ul>
                        </li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% endfor %}
                </div>    
                <div class="pagination">
                    <button id="prevPage" class="pagination-button prev-page">Précédent</button>
                    <button id="nextPage" class="pagination-button next-page">Suivant</button>
                </div>
            </div>
        </div>    
    </div>
</main>
{% endblock %}
