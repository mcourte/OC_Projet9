{% extends 'base_menu.html' %}
{% block content %}
{% load static %}
<link href="{% static 'css/home-review.css' %}" rel="stylesheet">
<main class="main-content">
    <div class="critique-grid">
            <div class="critique-column">
                <div id="formContent">
                    <h1 class="active">Publier une critique</h1>
                    <form method="post" action="{% url 'create_ticket_review' %}" class="critique-form">
                        {% csrf_token %}
                        <input type="submit" class="fadeIn second" value="Publier une critique">
                    </form>
                </div>
            </div>    
            <div class="critique-column">
                <div id="formContent">
                    <h1 class="active">Demander une critique</h1>
                    <form method="post" action="{% url 'create_ticket' %}" class="critique-form">
                        {% csrf_token %}
                        <input type="submit" class="fadeIn second" value="Demander une critique">
                    </form>
                </div>
            </div>
            <div class="critique-column" style="grid-column: span 2;">
                <div id="formContent-critique">
                    <h1 class="active">Tickets et Critiques des utilisateurs suivis</h1>
                    {% for item in combined_list %}
                        {% if item.type == 'ticket' %}
                            <div class="line ticket">
                                <h2 class="active"><strong>Ticket posté par : {{ item.user.username }}</strong></h2>
                                <ul>
                                    <li><strong>Titre : </strong>{{ item.title }}</li>
                                    <li><strong>Description : </strong>{{ item.description }}</li>
                                    <li><strong>Date de création :</strong> {% if item.time_created %}{{ item.time_created }}{% else %}{{ item.ticket.time_created }}{% endif %}</li>
                                    {% if item.image %}
                                        <li><img src="{{ item.image.url }}" alt="{{ item.title }}" class="image-posts"></li>
                                    {% endif %}
                                </ul>
                                {% if item.user != request.user %}
                                    {% if not item.user_has_review %}
                                        <!-- Si l'utilisateur n'a pas encore posté de critique, afficher le bouton pour créer une critique -->
                                        <form method="post" action="{% url 'create_review' item.id %}">
                                            {% csrf_token %}
                                            <input type="hidden" name="ticket_id" value="{{ item.id }}">
                                            <input type="submit" class="fadeIn second" value="Créer une critique">
                                        </form>
                                    {% endif %}
                                {% endif %}
                            </div>
                        {% elif item.type == 'review' %}
                            <div class="line review">
                                <h2 class="active"><strong> Critique écrite par {% if item.user == request.user %} Vous {% else %} {{ item.user.username }} {% endif %}</strong></h2>
                                <ul>
                                    <li><strong>Critique</strong></li>
                                    <li><strong>Titre : </strong> {{ item.headline }}</li>
                                    <li><strong>Note : </strong>
                                        <div class="rating">
                                            {% for _ in item.get_rating_range %}
                                                <span class="star">&#9733;</span>
                                            {% endfor %}
                                            {% for _ in item.get_complement_range %}
                                                <span class="star">&#9734;</span>
                                            {% endfor %}
                                        </div>
                                    </li>
                                    <li><strong>Description : </strong> {{ item.body }}</li>
                                    <li><strong>Date de création : </strong> {{ item.time_created }}</li>
                                </ul>
                                <div class="line review review-ticket">
                                <ul>
                                    <li><strong>Ticket {{ item.ticket.title }} </strong></li>
                                    <li><strong>Posté par : </strong>{% if item.ticket.user == request.user %} Vous {% else %} {{ item.ticket.user.username }} {% endif %}{{ item.ticket.title }}</li>
                                    <li><strong>Titre : </strong>{{ item.ticket.title }}</li>
                                    <li><strong>Description : </strong>{{ item.ticket.description }}</li>
                                    <li><strong>Date de création : </strong>{{ item.ticket.time_created }}</li>
                                    {% if item.ticket.image %}
                                        <li><img src="{{ item.ticket.image.url }}" alt="{{ item.ticket.title }}" class="image-posts"></li>
                                    {% endif %}
                                </ul>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>

    </div>
    <div class="pagination">
        <button id="prevPage" class="pagination-button prev-page">Précédent</button>
        <button id="nextPage" class="pagination-button next-page">Suivant</button>
    </div>
</main>
{% endblock %}
